# Introduction

## MbioAssy 2.0 简介

MbioAssy 2.0 是一个集成的 R
语言脚本工具包，旨在量化评估微生物群落构建过程中的生态随机性（Stochasticity）和确定性（Determinism）。该版本整合了四个主要模块：标准化随机率（NST）计算、中性模型（Neutral
Model）分析、iCAMP 空模型分析、C-score
方差分析，以及共现网络（Co-occurrence Network）构建与分析功能。

主要参考文献包括：

- Ning et al. (2019) PNAS (NST)
- Burns et al. (2016) ISME J (Neutral Model)
- Ning et al. (2020) Nature Communications (iCAMP)
- Ju et al. (2014) Environmental Microbiology (Network & C-score)

------------------------------------------------------------------------

## 核心概念通俗解释 (小白必读)

为了方便理解，我们将文档中涉及的专业术语进行通俗化解读：

### 1. 什么是 “群落构建 (Community Assembly)”？

想象一个空房间（一个新的环境），陆陆续续有人（微生物）搬进来住。**群落构建**就是研究“为什么是这些人搬进来了，而不是别人？” -
是因为房间条件（环境因子，如温度、pH）只适合这类人住？（**确定性过程**） -
还是纯粹因为运气好，刚好路过就进来了？（**随机性过程**）

### 2. 确定性 vs 随机性 (Determinism vs Stochasticity)

- **确定性 (Determinism)**:
  “优胜劣汰，适者生存”。环境条件（如高盐、高温）非常严格，只有特定的微生物能活下来。这就像**考试录取**，只有分数够高（适应环境）的才能进。
- **随机性 (Stochasticity)**:
  “一切皆有可能，全凭运气”。出生、死亡、迁移都是随机发生的。这就像**摇号买房**，谁能买到主要看运气，跟能力关系不大。

### 3. 零模型 (Null Model) —— 找参照物的标尺

在生态学统计中，我们很难直接说一个现象是不是随机的。
**零模型**就是用计算机模拟一个“完全随机的世界”。它通过把原始数据打乱（比如把物种名字洗牌），生成一个人工的、没有任何规律的数据集。

- 如果**真实观测数据**和**随机模拟数据**长得很像 $\rightarrow$
  说明真实世界也是随机的。
- 如果**真实观测数据**和**随机模拟数据**差别很大 $\rightarrow$
  说明真实世界有特定的规律（确定性）。

### 4. 各种分析方法到底在算什么？

#### **NST (标准化随机率)**

- **打分卡**: 它给群落打一个分（0% 到 100%）。
- **红线**: 50% 是分界线。
  - **\> 50%**: 说明“运气”（随机性）占主导地位。
  - **\< 50%**: 说明“规则”（确定性）占主导地位。

#### **中性模型 (Neutral Model)**

- **假设**:
  假设所有微生物都是“平庸”的，能力都一样（中性），谁在某个地方多，纯粹是因为它在总库里本来就多，或者它跑得快（扩散）。
- **结果**:
  - **落在预测区间内**: 说明这个物种是“随波逐流”的（中性/随机）。
  - **高于预测**: 说明它被环境“特别优待”了（主动选择）。
  - **低于预测**: 说明它被环境“特意排挤”了。

#### **iCAMP (系统发育分箱分析)**

- 这是一个**高倍显微镜**。
- 传统方法是把所有微生物混在一起算。iCAMP
  认为“龙生龙，凤生凤”，亲缘关系近的微生物（比如同一个“科”的）往往有相似的生存习惯。
- 它把微生物按亲缘关系分成不同的小组（Bin），然后对**每个小组**单独算它是受环境影响大，还是受运气影响大。这能让我们看得更细致。
  - **Homogeneous Selection (同质选择)**:
    环境一样，所以选出来的微生物也一样。
  - **Variable Selection (变量选择)**:
    环境变了，选出来的微生物也跟着变了。
  - **Dispersal Limitation (扩散限制)**:
    想去去不了（路被堵了，或者飞不过去）。
  - **Homogenizing Dispersal (同质扩散)**:
    大家到处乱跑，把所有地方都混得差不多了。
  - **Drift (漂变)**: 纯随机事件（生老病死）。

#### **C-score (棋盘分数)**

- **含义**: 衡量物种之间“老死不相往来”的程度。
- **直喻**: 如果物种 A 和物种 B 就像“死对头”，有 A 的地方就没 B，有 B
  的地方就没 A，这就是“竞争排斥”，C-score 就会很高。

#### **共现网络 (Co-occurrence Network)**

- **含义**: 微生物的“社交网络图”。
- **点 (Node)**: 代表微生物。
- **线 (Edge)**: 代表它们之间的关系。
  - 连线说明它们经常一起出现（合作/共生）或者死对头（竞争）。
- **RMT (随机矩阵理论)**:
  一种用来自动决定“什么样的关系才算铁哥们（阈值）”的高级数学方法，避免了人为主观瞎猜。

------------------------------------------------------------------------

## 原创性与技术实现分析

**核心结论：** MbioAssy 2.0
主要是一个**集成型工具包（Pipeline/Wrapper）**，而非底层算法的原创开发。它通过整合现有的成熟
R
包和已发表的统计算法，为微生物群落构建机制的研究提供了一站式的分析流程。

### 1. 技术实现方式

该工具包主要调用了以下第三方 R 包来实现核心功能：

- **NST 分析**: 直接调用 `NST` 包（Ning et al., 2019 开发）。
- **iCAMP 分析**: 直接调用 `iCAMP` 包（Ning et al., 2020 开发），并依赖
  `ape` 包处理系统发育树。
- **中性模型**: 基于 `minpack.lm`（非线性最小二乘法拟合）和 `stats4`
  包实现，代码主要改编自 Burns et al. (2016) 的公开脚本。
- **C-score 分析**: 调用 `EcoSimR` 包进行零模型模拟。
- **网络分析**: 核心计算依赖 `igraph`（图论算法）、`vegan`（生态统计）和
  `Hmisc`（相关性计算）。RMT 阈值确定调用了 `RMThreshold` 包。

### 2. 创新性评价

- **集成创新**: 它的主要价值在于将分散在不同文献和软件包中的分析方法（如
  NST、iCAMP、中性模型、网络分析）整合到一个统一的工作流中。这极大降低了研究人员的学习成本，无需分别去寻找和调试各个独立的脚本。
- **流程标准化**: 提供了一套标准化的输入输出格式（如 OTU 表、Group
  表），使得数据在不同分析模块间流转更加顺畅。
- **应用导向**: 针对微生物生态学特定的科学问题（“随机性 vs
  确定性”）进行了针对性的功能筛选和封装，不仅提供计算，还包含了可视化绘图（ggplot2）和结果统计导出功能。

------------------------------------------------------------------------

## 模块功能详细介绍

### 1. 标准化随机率计算 (Normalized Stochasticity Ratio, NST)

**功能描述**： 基于零模型（Null Model）量化群落构建中的随机性程度。NST
值介于 0 到 1 之间，以 0.5 为分界线（\>0.5 表示随机性主导，\<0.5
表示确定性主导）。

**输入文件 (Input)**：

- `OTU.txt`: 微生物丰度表（列为 OTU，行为样本）。
- `Group.txt`: 样本分组信息表。

**输出文件 (Output)**：

- `NST.output.txt`: 包含不同组别的 NST 指数计算结果摘要。

**代码对应**：`1_NST.R`

------------------------------------------------------------------------

### 2. 中性模型分析 (Neutral Model Analysis)

**功能描述**： 基于 Sloan
中性群落模型，评估随机过程（扩散和生态漂变）对群落构建的贡献。该模型预测分类单元在局域群落中的出现频率与其在元群落中的平均相对丰度之间的关系。

**输入文件 (Input)**：

- `OTU.txt`: 微生物丰度表。

**输出文件 (Output)**：

- `Neutral.model.plot.pdf`:
  中性模型拟合曲线图，展示物种出现频率与平均相对丰度的关系，并标注
  $R^{2}$ 和迁移率 $m$。
- `Neutral.model.details.txt`:
  每个物种的详细预测数据（如观测频率、预测频率、是否在中性预测范围内）。

**代码对应**：`2_Neutral_model.R`

------------------------------------------------------------------------

### 3. iCAMP 空模型分析 (iCAMP Assembly)

**功能描述**：
通过推断群落组装机制的系统发育分箱（Binning）方法（iCAMP），定量分析不同生态过程（如均质选择、变量选择、扩散限制、均质扩散、漂变等）对群落构建的相对重要性。这是一种比传统
QPEN/NST 更精细的方法，因为它在不同的系统发育分箱（Bin）水平上进行评估。

**输入文件 (Input)**：

- `OTU.txt`: 微生物丰度表。
- `Tree.nwk`: 系统发育树文件。
- `Group.txt`: 样本分组信息。
- `Env.txt`: 环境因子变量表（用于生态位差异分析）。
- `Taxonomy.txt`: 物种分类信息表。

**输出文件 (Output)**：

- `Test.ProcessImportance_EachGroup.csv`:
  每组样本中各生态过程的相对重要性。
- `Test.ProcessImportance_EachBin_EachGroup.csv`: 每个 Bin
  在每组样本中受各生态过程支配的程度。
- `Test.BinContributeToProcess_EachGroup.csv`: 每个 Bin
  对各生态过程重要性的贡献度。
- `Test.Taxon_Bin.csv` & `Test.Bin_TopTaxon.csv`: Bin
  与分类单元的对应关系及主要物种信息。
- `Test.iCAMP.Summary.rda`: 包含完整分析结果的 R 数据对象。

**代码对应**：`3_iCAMP_Assembly.R`

------------------------------------------------------------------------

### 4. C-score 方差分析 (C-score-var Analysis)

**功能描述**： 通过计算 C-score（Checkerboard
score）的方差来推断群落构建机制。结合生态位理论，用于评估物种间的竞争排斥或环境过滤作用。

**输入文件 (Input)**：

- `OTU.txt`: 微生物丰度表。

**输出文件 (Output)**：

- `c-score-var.summary.txt`: 包含 C-score 方差分析的统计摘要。
- `c-score-var.hist.500.emf`: 观测值与随机模拟值分布的直方图。

**代码对应**：`4_C-score-var.R`

------------------------------------------------------------------------

### 5. 共现网络构建 (Co-occurrence Network Construction)

包含两种构建方法：

#### 5.1 基础共现网络

**功能描述**：基于 Spearman
相关性系数构建网络，通过设定的相关系数阈值（如 \>0.8）和显著性 P 值（如
\<0.05）来确定物种间的连接。

#### 5.2 RMT 基于随机矩阵理论的网络 (RMT-based)

**功能描述**：利用随机矩阵理论（RMT）自动寻找最优的相关性阈值，而不是人为设定固定阈值，从而构建更加客观的生态网络。

**输入文件 (Input)**：

- `OTU.txt`: 微生物丰度表。

**输出文件 (Output)**：

- `Network.gml`: 网络文件，可用 Gephi 或 Cytoscape 可视化。
- `Network.global.topology.csv`:
  全局拓扑属性（如节点数、边数、平均路径长度、模块化程度等）。
- `Network.node.topology.csv`:
  节点拓扑属性（如度、介数中心性、接近中心性等）。

**代码对应**：`5.1_Co-occurrence_network.R` 和
`5.2_RMT_Co-occurrence_network.R`

------------------------------------------------------------------------

### 6. 随机网络生成 (Random Network)

**功能描述**： 生成与观测网络具有相同节点数和边数的随机网络（Erdős-Rényi
模型），用于比较和验证观测网络的非随机性拓扑特征。

**输入参数**：

- 代码中需手动设定节点数 `n` 和边数 `e`。

**输出文件 (Output)**：

- `N[n]E[e].er.random.network.xls`: 1000
  个随机网络的全局拓扑属性统计表。
